<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of LoadXml</title>
  <meta name="keywords" content="LoadXml">
  <meta name="description" content="function [xml, rxml] = LoadXml(FileBase)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">Helpers</a> &gt; LoadXml.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for Helpers&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>LoadXml
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [xml, rxml] = LoadXml(FileBase)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function [xml, rxml] = LoadXml(fbasename,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">function [xml, rxml] = LoadXml(FileBase)
loads the xml file using xmltools (have to have it in the path)
 rxml returns it's original layout - very messy structure but contains all
 the xml file contents.
 xml - is the ouput structure which is backwards compatible to LoadPar
 output, so you can use it instead ..also loads some usefull stuff -
 Anatomoical groups with Skips , Spike electrode groups
 more can be added later (e.g. parameters of the process scripts)
 this script is written for xml version 1.1 .. older version doesn't work.
 additions are welcome
 
 By default, fbasename is the name of the directory where the data are, so
 the exact xml file path should not be put in argument
 By calling
 xml = LoadXml(xmlfile,'raw')
 the xml file specified in argument will be loaded
 (added by A Peyrache)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <span class="comment">%function [xml, rxml] = LoadXml(FileBase)</span>
0002 <span class="comment">%loads the xml file using xmltools (have to have it in the path)</span>
0003 <span class="comment">% rxml returns it's original layout - very messy structure but contains all</span>
0004 <span class="comment">% the xml file contents.</span>
0005 <span class="comment">% xml - is the ouput structure which is backwards compatible to LoadPar</span>
0006 <span class="comment">% output, so you can use it instead ..also loads some usefull stuff -</span>
0007 <span class="comment">% Anatomoical groups with Skips , Spike electrode groups</span>
0008 <span class="comment">% more can be added later (e.g. parameters of the process scripts)</span>
0009 <span class="comment">% this script is written for xml version 1.1 .. older version doesn't work.</span>
0010 <span class="comment">% additions are welcome</span>
0011 <span class="comment">%</span>
0012 <span class="comment">% By default, fbasename is the name of the directory where the data are, so</span>
0013 <span class="comment">% the exact xml file path should not be put in argument</span>
0014 <span class="comment">% By calling</span>
0015 <span class="comment">% xml = LoadXml(xmlfile,'raw')</span>
0016 <span class="comment">% the xml file specified in argument will be loaded</span>
0017 <span class="comment">% (added by A Peyrache)</span>
0018 
0019 <a name="_sub0" href="#_subfunctions" class="code">function [xml, rxml] = LoadXml(fbasename,varargin)</a>
0020 xml = struct;
0021 
0022 <span class="comment">%if isempty(varargin)</span>
0023 <span class="comment">%    [fbasename mergedir rootdir] = extractfbasename(fbasename);</span>
0024 <span class="comment">%elseif strcmpi(varargin,'raw')</span>
0025 <span class="comment">%    fprintf('Loading directly xml file')</span>
0026 <span class="comment">%else</span>
0027 <span class="comment">%    error('Unrecognized option')</span>
0028 <span class="comment">%end</span>
0029 <span class="comment">%if xml was in the filebase by chance</span>
0030 xmli = strfind(fbasename,<span class="string">'.xml'</span>);
0031 <span class="keyword">if</span> ~isempty(xmli)
0032     fbasename = fbasename(1:xmli-1);
0033 <span class="keyword">end</span>
0034 rxml = xmltools([fbasename <span class="string">'.xml'</span>]);
0035 
0036 rxml = rxml.child(2);
0037 
0038 <span class="comment">% from this level all children are the different parameters fields</span>
0039 
0040 xml.FileName = fbasename;
0041 
0042 <span class="keyword">for</span> i=1:length(rxml.child)
0043 
0044     <span class="keyword">switch</span> rxml.child(i).tag
0045         
0046         <span class="keyword">case</span> <span class="string">'generalInfo'</span>
0047             xml.Date = rxml.child(i).child(1).value; <span class="comment">% date of xml file creation?</span>
0048 
0049         <span class="keyword">case</span> <span class="string">'acquisitionSystem'</span>
0050             xml.nBits = str2num(rxml.child(i).child(1).value); <span class="comment">% number of bits of the file</span>
0051             xml.nChannels = str2num(rxml.child(i).child(2).value);
0052             xml.SampleRate = str2num(rxml.child(i).child(3).value);
0053             xml.SampleTime = 1e6/xml.SampleRate; <span class="comment">%to make backwards compatible</span>
0054             xml.VoltageRange = str2num(rxml.child(i).child(4).value);
0055             xml.Amplification = str2num(rxml.child(i).child(5).value);
0056             xml.Offset =  str2num(rxml.child(i).child(6).value);
0057             
0058         <span class="keyword">case</span> <span class="string">'fieldPotentials'</span>
0059             xml.lfpSampleRate = str2num(rxml.child(i).child.value);
0060             
0061         <span class="keyword">case</span> <span class="string">'anatomicalDescription'</span>
0062             tmp = rxml.child(i).child.child;
0063             <span class="keyword">for</span> grpI =1:length(tmp)
0064                 <span class="keyword">for</span> chI=1:length(tmp(grpI).child)
0065                     xml.AnatGrps(grpI).Channels(chI) = str2num(tmp(grpI).child(chI).value);
0066                     xml.AnatGrps(grpI).Skip(chI) = str2num(tmp(grpI).child(chI).attribs.value);
0067                 <span class="keyword">end</span>
0068             <span class="keyword">end</span>
0069             
0070         <span class="keyword">case</span> <span class="string">'spikeDetection'</span>
0071             <span class="keyword">if</span> ~isempty(rxml.child(i).child)
0072                 tmp =rxml.child(i).child.child;
0073                 <span class="keyword">for</span> grpI =1:length(tmp)
0074                     <span class="keyword">for</span> chI=1:length(tmp(grpI).child(1).child)
0075                         xml.SpkGrps(grpI).Channels(chI) = str2num(tmp(grpI).child(1).child(chI).value);
0076                     <span class="keyword">end</span>
0077                     <span class="keyword">if</span> length(tmp(grpI).child)&gt;1
0078                         xml.SpkGrps(grpI).nSamples = str2num(tmp(grpI).child(2).value);
0079                         xml.SpkGrps(grpI).PeakSample = str2num(tmp(grpI).child(3).value);
0080                         xml.SpkGrps(grpI).nFeatures = str2num(tmp(grpI).child(4).value);
0081                     <span class="keyword">end</span>
0082                     <span class="comment">%backwards compatibility</span>
0083                     xml.nElecGps = length(tmp);
0084                     xml.ElecGp{grpI} = xml.SpkGrps(grpI).Channels;
0085                 <span class="keyword">end</span>
0086             <span class="keyword">else</span>
0087                 xml.nElecGps = 0;
0088             <span class="keyword">end</span>
0089 
0090 
0091         <span class="keyword">case</span> <span class="string">'programs'</span>
0092             tmp = rxml.child(i).child;
0093             <span class="keyword">for</span> i=1:length(tmp)
0094                 <span class="keyword">if</span> strcmp(tmp(i).child(1).value,<span class="string">'process_mhipass'</span>)
0095                     <span class="keyword">for</span> j=1:length(tmp(i).child(2).child )
0096                         <span class="keyword">if</span> strcmp(tmp(i).child(2).child(j).child(1).value,<span class="string">'frequency'</span>)
0097                             xml.HiPassFreq = str2num(tmp(i).child(2).child(j).child(2).value);
0098                             <span class="keyword">break</span>
0099                         <span class="keyword">end</span>
0100                     <span class="keyword">end</span>
0101                 <span class="keyword">end</span>
0102             <span class="keyword">end</span>
0103     <span class="keyword">end</span>
0104 
0105 
0106 <span class="keyword">end</span>
0107 
0108 
0109 <span class="comment">% general recursive parsing will have to wait.</span></pre></div>
<hr><address>Generated on Tue 01-Sep-2015 15:03:35 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>